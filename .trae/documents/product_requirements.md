# 连接器中间件项目 - 产品需求文档 (PRD)

## 1. 项目概述
本项目旨在开发一个高性能的连接器中间件，用于连接仓库系统与云仓标准接口。核心解决不同系统间接口路径不一致、参数结构不一致的问题，并提供动态配置管理能力，确保业务对接的灵活性和稳定性。

## 2. 用户角色
- **系统管理员**: 负责系统的部署、监控和全局配置。
- **运维/实施人员**: 负责具体接口的转发规则配置、参数映射配置和日志排查。

## 3. 核心功能需求

### 3.1 接口路由转发
- **动态路由**: 支持将请求从连接器 URL 动态转发到目标云仓系统的标准接口路径。
  - 示例: `POST /connector/wms-a/inbound` -> `POST https://cloud-wms.com/api/v1/inbound`
- **全方法支持**: 支持 GET, POST, PUT, DELETE, PATCH 等所有标准 HTTP 方法。
- **透传机制**: Headers、Body、Query Parameters 默认透传，除非被映射规则覆盖。

### 3.2 请求参数转换
- **字段映射**: 支持 JSON 请求体的字段重命名。
  - 示例: `{"aa": "value"}` -> `{"a": "value"}`
- **嵌套结构支持**: 支持多层级 JSON 对象的映射。
  - 示例: `{"order": {"id": 123}}` -> `{"order_info": {"order_no": 123}}`
- **默认保留**: 未在规则中定义的字段，默认原样保留（可配置开关）。
- **类型转换 (可选)**: 简单的类型转换（如 String 转 Number），主要关注字段名映射。

### 3.3 动态配置管理
- **可视化管理界面**: 提供 Web 界面用于管理转发规则和映射配置。
- **规则配置**:
  - 定义源路径 (Source Path)
  - 定义目标 URL (Target URL)
  - 定义 HTTP 方法匹配
  - 定义请求/响应映射规则 (JSON Schema 或 键值对映射)
- **实时生效**: 配置修改后，无需重启服务，立即生效。
- **版本管理**:
  - 保存配置的历史版本。
  - 支持一键回滚到指定版本。
- **变更日志**: 记录谁在什么时候修改了什么配置。

### 3.4 监控与日志
- **请求日志**: 记录所有进出连接器的请求详情（时间、源 IP、路径、耗时、状态码）。
- **错误日志**: 详细记录转发失败、映射失败的异常信息。
- **监控指标**: 提供 TPS (Transactions Per Second)、平均响应时间、P99 延迟、错误率等指标。

## 4. 非功能性需求
- **高性能**: 请求转发内部处理延迟 < 100ms (P99)。
- **高并发**: 支持 1000+ TPS。
- **高可用**: 支持多实例部署，配置存储高可用。
- **稳定性**: 实现熔断机制（当下游服务不可用时快速失败）和失败重试策略（针对网络波动等临时错误）。
- **安全性**: 管理界面需要认证授权。

## 5. 页面设计 (管理后台)
1. **登录页**: 管理员登录。
2. **仪表盘**: 展示系统当前 QPS、错误率、最近请求日志概览。
3. **路由规则列表**: 展示所有配置的转发规则，支持增删改查。
4. **规则详情/编辑页**:
   - 基础信息：名称、描述、源路径、目标 URL。
   - 映射配置：源字段 -> 目标字段的映射表格或 JSON 编辑器。
   - 高级配置：超时时间、重试次数、熔断阈值。
5. **配置版本历史**: 查看某条规则的历史版本，支持回滚。
6. **日志查询**: 按时间、路径、状态码搜索请求日志。
