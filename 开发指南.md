# Connector 项目开发指南

本文档旨在规范 Connector 项目的前后端开发流程与代码风格，确保团队协作的高效性与代码的可维护性。

---

## 1. 后端开发规范 (Backend)

后端采用 **Spring Boot + MyBatis-Plus** 架构，遵循分层开发模式。

### 1.1 分层架构

代码组织遵循标准的 MVC 三层架构，并引入 Manager 层处理复杂逻辑：

*   **Controller (`controller`)**: 负责接收 HTTP 请求，参数校验，权限校验，调用 Service，并返回统一的 `ResponseDTO`。
    *   **位置**: `net.lab1024.sa.admin.module.{module_name}.{biz_name}.controller`
    *   **注解**: `@RestController`, `@Tag` (Swagger), `@Operation` (Swagger), `@SaCheckPermission` (权限)。
*   **Service (`service`)**: 核心业务逻辑层。负责业务规则校验、数据处理、事务控制。
    *   **位置**: `net.lab1024.sa.admin.module.{module_name}.{biz_name}.service`
    *   **注解**: `@Service`
*   **Manager (`manager`)**: (可选) 通用业务处理层。对第三方平台封装的层，预处理返回结果及转化异常信息；对 Service 层通用能力的下沉，如缓存处理、中间件处理；与 Dao 层交互，对多个 Dao 的组合复用。
    *   **位置**: `net.lab1024.sa.admin.module.{module_name}.{biz_name}.manager`
    *   **继承**: `ServiceImpl<Dao, Entity>`
*   **Dao (`dao`)**: 数据访问层。
    *   **位置**: `net.lab1024.sa.admin.module.{module_name}.{biz_name}.dao`
    *   **继承**: `BaseMapper<Entity>`
    *   **注解**: `@Mapper`

### 1.2 对象定义 (Domain)

*   **Entity (`domain.entity`)**: 数据库实体对象，与数据库表一一对应。
    *   使用 `@TableName`, `@TableId` 注解。
*   **VO (`domain.vo`)**: View Object，展示层对象，用于返回给前端的数据。
    *   使用 `@Schema` 描述字段含义。
    *   **禁止**直接返回 Entity 给前端，必须转换为 VO。
*   **Form (`domain.form`)**: 表单对象，用于接收前端传入的参数（查询、新增、修改）。
    *   查询表单继承 `PageParam`。
    *   使用 `@Schema` 描述字段。
    *   使用 JSR-303 注解（`@NotNull`, `@Length` 等）进行校验。

### 1.3 统一返回格式

所有 Controller 接口必须返回 `ResponseDTO<T>` 对象：

```java
// 成功返回
return ResponseDTO.ok(data);

// 失败返回
return ResponseDTO.userErrorParam("参数错误");
```

### 1.4 常用注解示例

```java
@RestController
@Tag(name = "路由管理")
public class ConnectorRouteController {

    @Resource
    private ConnectorRouteService connectorRouteService;

    @Operation(summary = "查询路由列表")
    @PostMapping("/connector/route/query")
    @SaCheckPermission("connector:route:query")
    public ResponseDTO<PageResult<ConnectorRouteVO>> query(@Valid @RequestBody ConnectorRouteQueryForm queryForm) {
        return connectorRouteService.queryPage(queryForm);
    }
}
```

---

## 2. 前端开发规范 (Frontend)

前端采用 **Vue 3 + Vite + Ant Design Vue** 技术栈。

### 2.1 目录结构

*   `src/api/business/{module}/`: 存放后端接口定义文件（如 `connector-api.js`）。
*   `src/views/business/{module}/`: 存放页面组件。
    *   列表页通常命名为 `{biz}-list.vue`。
    *   弹窗组件放在 `components/` 子目录下。

### 2.2 API 定义

使用 `getRequest`, `postRequest` 进行封装：

```javascript
import { getRequest, postRequest } from '/@/lib/axios';

export const connectorApi = {
  // 分页查询
  queryRoutePage: (param) => {
    return postRequest('/connector/route/query', param);
  },
  // 获取详情
  getRouteDetail: (id) => {
    return getRequest(`/connector/route/detail/${id}`);
  }
};
```

### 2.3 Vue 组件风格

统一使用 Vue 3 **Composition API** (`<script setup>`)。

*   **响应式变量**: 使用 `ref` 定义基本类型，`reactive` 定义对象（如表单数据）。
*   **生命周期**: 使用 `onMounted` 进行初始化数据加载。
*   **组件通信**: 使用 `defineProps`, `defineEmits`。

**示例代码结构**:

```vue
<template>
  <a-form class="smart-query-form">...</a-form>
  <a-table :dataSource="tableData" ... />
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue';
import { connectorApi } from '/@/api/business/connector/connector-api';

// 1. 定义数据
const tableLoading = ref(false);
const tableData = ref([]);
const queryForm = reactive({ ... });

// 2. 定义方法
async function queryData() {
  tableLoading.value = true;
  try {
    const res = await connectorApi.queryRoutePage(queryForm);
    tableData.value = res.data.list;
  } finally {
    tableLoading.value = false;
  }
}

// 3. 生命周期
onMounted(queryData);
</script>
```

### 2.4 标准列表页功能

为提高用户体验和开发效率，标准列表页应包含以下基础功能：

*   **高级查询**: 使用 `SmartQueryForm` 布局。
*   **表格操作栏**: 包含 新建、批量删除、导入、导出 按钮，以及 **列设置** (`TableOperator`)。
*   **列设置**: 使用 `TableOperator` 组件，支持列的显示/隐藏、宽度调整、固定列等。
*   **动态高度**: 自动计算表格高度 (`yHeight`)，适应不同屏幕分辨率。
*   **排序功能**: 表格列支持 `sorter: true`，并在后端 `PageParam` 中接收 `sortItemList`。
*   **导入导出**: 提供标准的导入导出按钮及交互模式。

**代码示例 (TenantList)**:

```vue
<template>
    <!-- 工具栏 -->
    <a-row class="smart-table-btn-block">
      <div class="smart-table-operate-block">
        <a-button type="primary" @click="add">新建</a-button>
        <a-button @click="batchDelete" danger>批量删除</a-button>
        <a-button @click="import" type="primary">导入</a-button>
        <a-button @click="export" type="primary">导出</a-button>
      </div>
      <div class="smart-table-setting-block">
        <!-- 列设置组件 -->
        <TableOperator v-model="columns" :tableId="TABLE_ID" :refresh="query" />
      </div>
    </a-row>

    <!-- 表格 -->
    <a-table
      :columns="columns"
      :dataSource="tableData"
      :scroll="{ x: 1000, y: yHeight }"
      @change="onChange"
      @resizeColumn="handleResizeColumn"
    >
       <!-- Header Search -->
       <template #headerCell="{ column }">
        <SmartHeaderCell v-model:value="queryForm[column.dataIndex]" :column="column" @change="query" />
      </template>
    </a-table>
</template>
```

---

## 3. 数据库设计规范

*   **表名**: 统一使用 `t_` 前缀，如 `t_connector_route`。
*   **主键**: 统一使用 `bigint(20)`，自增，字段名为 `{table_name_suffix}_id` (例如 `route_id`) 或简单的 `id` (视项目历史习惯而定，本项目倾向于 `route_id` 风格)。
*   **必填字段**:
    *   `create_time` (datetime): 创建时间
    *   `update_time` (datetime): 更新时间
    *   `deleted_flag` (tinyint): 逻辑删除标识 (0: 未删除, 1: 已删除)

---

## 4. 命名规范

*   **Java 类名**: UpperCamelCase (如 `ConnectorRouteController`)。
*   **方法名/变量名**: lowerCamelCase (如 `queryRoutePage`)。
*   **常量**: UPPER_CASE_WITH_UNDERSCORES (如 `MAX_RETRY_COUNT`)。
*   **Vue 文件名**: kebab-case (如 `route-list.vue`)。
*   **数据库表/字段**: snake_case (如 `source_path`)。

---

## 5. 开发流程建议

1.  **设计阶段**: 确定数据库表结构，编写 SQL 脚本。
2.  **后端开发**:
    *   生成/编写 Entity, Dao, Mapper.xml。
    *   定义 VO 和 Form。
    *   编写 Service 业务逻辑。
    *   编写 Controller 接口。
    *   启动后端，使用 Swagger 调试接口。
3.  **前端开发**:
    *   编写 API 定义文件。
    *   编写 Vue 页面和组件。
    *   联调接口。
4.  **测试与提交**: 本地自测通过后提交代码。
